<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Experimental Design and Simulation • simrel</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Experimental Design and Simulation">
<meta property="og:description" content="simrel">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simrel</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mbrdsim.html">Experimental Design and Simulation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/simulatr/simrel">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://simulatr.github.io/simrel">
    <span class="fa fa-globe fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Experimental Design and Simulation</h1>
                        <h4 class="author">Raju Rimal</h4>
            
            <h4 class="date">2020-05-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/simulatr/simrel/blob/master/vignettes/mbrdsim.Rmd"><code>vignettes/mbrdsim.Rmd</code></a></small>
      <div class="hidden name"><code>mbrdsim.Rmd</code></div>

    </div>

    
    
<div id="loading-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-packages" class="anchor"></a>Loading Packages</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">simrel</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pls</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)</pre></body></html></div>
</div>
<div id="setting-up-parameters-list" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-parameters-list" class="anchor"></a>Setting up parameters list</h2>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">sim_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">p</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">20</span>, <span class="fl">150</span>),
    <span class="kw">gamma</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.2</span>, <span class="fl">1.1</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">4</span>),
    <span class="kw">relpos</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>)), <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">6</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>))),
    <span class="kw">R2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.4</span>, <span class="fl">0.8</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>)),
    <span class="kw">ypos</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">3</span>)), <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>), <span class="fl">2</span>))
  )</pre></body></html></div>
<p><code>mbrdsim</code> function in simrel lets user to create a factorial fractional design from the parameter list. From the <code>sim_list</code> defined above, we have two levels of “number of variables (p)”, four level of multicollineary level controlled by <code>gamma</code>. In addition, two levels of positions of relevant components and coefficient of determination are also defined. Further, we have set up two way to combine the response components. We have two informative dimension of response at first and second components. In one level, we combined the uninformative component three with first component and in another level, we combine it with second component. The additional parameters for simulation are fixed as follows,</p>
</div>
<div id="experimental-design" class="section level2">
<h2 class="hasAnchor">
<a href="#experimental-design" class="anchor"></a>Experimental Design</h2>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">design</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/mbrdsim.html">mbrdsim</a></span>(<span class="no">sim_list</span>, <span class="kw">fraction</span> <span class="kw">=</span> <span class="fl">3</span>)<span class="kw">[[</span><span class="st">"Design"</span>]]
  <span class="no">design</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(
    <span class="no">design</span>,
    <span class="kw">q</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">design</span>[, <span class="st">"p"</span>], <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">x</span>/<span class="fl">2</span>, <span class="fl">2</span>)),
    <span class="kw">type</span> <span class="kw">=</span> <span class="st">"multivariate"</span>,
    <span class="kw">n</span> <span class="kw">=</span> <span class="fl">100</span>,
    <span class="kw">ntest</span> <span class="kw">=</span> <span class="fl">200</span>,
    <span class="kw">m</span> <span class="kw">=</span> <span class="fl">3</span>,
    <span class="kw">eta</span> <span class="kw">=</span> <span class="fl">0.6</span>
  )</pre></body></html></div>
<p>From the simulation parameters in each row of <code>design</code> table, we run our simulation.</p>
</div>
<div id="simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h2>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">sobj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">design</span>, <span class="fl">1</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">simrel</span>, <span class="no">x</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">sobj</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Design"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq.int</a></span>(<span class="no">sobj</span>))</pre></body></html></div>
<p>Now we have eight datasets with distict properties as we have desired. We can now use these datasets in order to compare PCR and PLS estimation methods.</p>
</div>
<div id="comparison-of-estimation-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-of-estimation-methods" class="anchor"></a>Comparison of Estimation Methods</h2>
<p>The estimation methods we have used here is PCR and PLS. Now we can fit each of our data using PCR and PLS method.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
  <span class="no">fit</span>$<span class="no">pcr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">sobj</span>, <span class="kw">function</span>(<span class="no">obj</span>) {
    <span class="no">dta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">obj</span>$<span class="no">X</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">obj</span>$<span class="no">Y</span>))
    <span class="fu"><a href="https://rdrr.io/pkg/pls/man/mvr.html">pcr</a></span>(<span class="no">y</span> ~ <span class="no">x</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">dta</span>, <span class="kw">validation</span> <span class="kw">=</span> <span class="st">"CV"</span>, <span class="kw">segments</span> <span class="kw">=</span> <span class="fl">10</span>)
  })
  <span class="no">fit</span>$<span class="no">pls</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">sobj</span>, <span class="kw">function</span>(<span class="no">obj</span>) {
    <span class="no">dta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">obj</span>$<span class="no">X</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">obj</span>$<span class="no">Y</span>))
    <span class="fu"><a href="https://rdrr.io/pkg/pls/man/mvr.html">plsr</a></span>(<span class="no">y</span> ~ <span class="no">x</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">dta</span>, <span class="kw">validation</span> <span class="kw">=</span> <span class="st">"CV"</span>, <span class="kw">segments</span> <span class="kw">=</span> <span class="fl">10</span>)
  })</pre></body></html></div>
<div id="calculating-rmsep" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-rmsep" class="anchor"></a>Calculating RMSEP</h3>
<p>We base our comparison on the basis of root mean square error of prediction. We can calculate and compare both cross-validated and test error.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">rmsep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">fit</span>, <span class="kw">function</span>(<span class="no">f</span>){
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">f</span>), <span class="kw">function</span>(<span class="no">d</span>){
      <span class="no">new_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">sobj</span><span class="kw">[[</span><span class="no">d</span>]], <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">testX</span>), <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">testY</span>)))
      <span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pls/man/mvrVal.html">RMSEP</a></span>(<span class="no">f</span><span class="kw">[[</span><span class="no">d</span>]], <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">new_data</span>, <span class="kw">estimate</span> <span class="kw">=</span> <span class="st">"all"</span>)
      <span class="kw pkg">reshape2</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span>(<span class="no">out</span><span class="kw">[[</span><span class="st">"val"</span>]])
    }, <span class="kw">simplify</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
  })</pre></body></html></div>
</div>
</div>
<div id="plotting-rmsep" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-rmsep" class="anchor"></a>Plotting RMSEP</h2>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">get_error_plot</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">dgn</span>){
    <span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">rmsep</span>, <span class="st">"[["</span>, <span class="no">dgn</span>))
    <span class="no">df</span>$<span class="no">method</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"\\.[0-9]+"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">df</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">df</span>) <span class="kw">&lt;-</span> <span class="kw">NULL</span>
    <span class="no">df</span>$<span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">df</span>$<span class="no">model</span> <span class="kw">==</span> <span class="st">"(Intercept)"</span>, <span class="st">"0"</span>, <span class="no">df</span>$<span class="no">model</span>)
    <span class="no">df</span>$<span class="no">model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"[A-Za-z]+"</span>, <span class="st">""</span>, <span class="no">df</span>$<span class="no">model</span>))
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">model</span>, <span class="no">value</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">estimate</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">estimate</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.5</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">response</span> ~ <span class="no">method</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"top"</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Predictors"</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"RMSEP"</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"Estimate"</span>)
  }</pre></body></html></div>
<p>The above function, can plot prediction error (RMSEP) from both estimation methods for all three response variables. Lets plot the error for first and second design,</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu">get_error_plot</span>(<span class="fl">1</span>)</pre></body></html></div>
<p><img src="mbrdsim_files/figure-html/unnamed-chunk-8-1.svg" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu">get_error_plot</span>(<span class="fl">2</span>)</pre></body></html></div>
<p><img src="mbrdsim_files/figure-html/unnamed-chunk-8-2.svg" width="90%" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://mathatistics.com">Raju Rimal</a>, <a href="http://solvsa.nmbu.no">Solve Sæbø</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
